<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1561.61">
  <style type="text/css">
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.0px; font: 13.0px Roboto; color: #000000; color: rgba(0, 0, 0, 0.87); -webkit-text-stroke: rgba(0, 0, 0, 0.87)}
    p.p3 {margin: 0.0px 0.0px 16.0px 0.0px; line-height: 15.0px; font: 13.0px Roboto; color: #000000; color: rgba(0, 0, 0, 0.87); -webkit-text-stroke: rgba(0, 0, 0, 0.87); background-color: #ffffff}
    p.p5 {margin: 0.0px 0.0px 16.0px 0.0px; line-height: 15.0px; font: 13.0px Courier; color: #000000; -webkit-text-stroke: #000000; background-color: #000000; background-color: rgba(0, 0, 0, 0.039)}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 16.0px; font: 11.1px Courier; color: #000000; -webkit-text-stroke: #000000; background-color: #f0f0f0}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 16.0px; font: 11.1px Courier; color: #880000; -webkit-text-stroke: #880000; background-color: #f0f0f0}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 16.0px; font: 11.1px Courier; color: #000000; -webkit-text-stroke: #000000; background-color: #f0f0f0; min-height: 13.0px}
    p.p11 {margin: 0.0px 0.0px 16.0px 0.0px; line-height: 15.0px; font: 13.0px Roboto; color: #0d9fff; -webkit-text-stroke: #0d9fff; background-color: #ffffff}
    li.li2 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.0px; font: 13.0px Roboto; color: #000000; color: rgba(0, 0, 0, 0.87); -webkit-text-stroke: rgba(0, 0, 0, 0.87)}
    li.li6 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.0px; font: 13.0px Roboto; color: #0d9fff; -webkit-text-stroke: #0d9fff}
    span.s1 {font-kerning: none}
    span.s2 {font: 13.0px STIXGeneral; font-kerning: none; background-color: #ffffff}
    span.s3 {font-kerning: none; background-color: #ffffff}
    span.s4 {background-color: #ffffff; -webkit-text-stroke: 0px #000000}
    span.s5 {font: 13.0px Roboto; font-kerning: none; color: #0d9fff; -webkit-text-stroke: 0px #0d9fff}
    span.s6 {font: 13.0px 'Apple Color Emoji'; font-kerning: none; background-color: #ffffff}
    span.s7 {font: 13.0px Roboto; font-kerning: none; color: rgba(0, 0, 0, 0.87); background-color: #ffffff; -webkit-text-stroke: 0px rgba(0, 0, 0, 0.87)}
    span.s8 {font-kerning: none; color: #0d9fff}
    span.s9 {font-kerning: none; color: #000000; -webkit-text-stroke: 0px #000000}
    span.s10 {font-kerning: none; color: #880000; -webkit-text-stroke: 0px #880000}
    span.s11 {font: 13.0px Courier; font-kerning: none; color: #000000; background-color: rgba(0, 0, 0, 0.039); -webkit-text-stroke: 0px #000000}
    span.s12 {font-kerning: none; color: rgba(0, 0, 0, 0.87); -webkit-text-stroke: 0px rgba(0, 0, 0, 0.87)}
    span.s13 {font-kerning: none; color: #0d9fff; -webkit-text-stroke: 0px #0d9fff}
    ul.ul1 {list-style-type: disc}
  </style>
</head>
<body>
<h1 style="margin: 0.0px 0.0px 16.0px 0.0px; line-height: 30.0px; font: 24.0px Roboto; color: #000000; color: rgba(0, 0, 0, 0.87); -webkit-text-stroke: rgba(0, 0, 0, 0.87); background-color: #ffffff"><span class="s1"><b>Access APIs with access and ID tokens</b></span></h1>
<p class="p2"><span class="s2">â­‘</span><span class="s3"> Note: Unlike the out of the box security code solution, access and ID tokens require setting up a process on AODocs to whitelist client IDs. This is not currently possible out of the box.</span></p>
<p class="p3"><span class="s1">In general, an access token is a piece of data that acts as a permit to operate on resources. Usually it's just a random-looking string of characters. A user who has access to resources on a resource server tells the authorization server it's OK for the client app to have the same access. The client app then gets a permit (token) it can present to the resource server with each request.</span></p>
<p class="p3"><span class="s1">The main reason to use access or ID tokens (instead of security code) is to provide the client app with secure delegated access to server resources on your behalf. It allows authorizing a client app to access and manipulate server resources within a specific scope/time, and without exposing the user's credentials to the app.</span></p>
<h2 style="margin: 0.0px 0.0px 16.0px 0.0px; line-height: 22.0px; font: 18.0px Roboto; color: #000000; color: rgba(0, 0, 0, 0.87); -webkit-text-stroke: rgba(0, 0, 0, 0.87); background-color: #ffffff"><span class="s1"><b>Generic authentication flow</b></span></h2>
<p class="p3"><span class="s1">Authentication flows generally follow this pattern:</span></p>
<ul class="ul1">
  <li class="li2"><span class="s4"></span><span class="s3">User asks app to access resource server.</span></li>
  <li class="li2"><span class="s4"></span><span class="s3">App asks resource server for access.</span></li>
  <li class="li2"><span class="s4"></span><span class="s3">If no token is included in the request, resource server redirects app to authorization server to obtain token.</span></li>
  <li class="li2"><span class="s4"></span><span class="s3">If identity has not been established yet, authorization server redirects app to identity provider.</span></li>
  <li class="li2"><span class="s4"></span><span class="s3">Identity provider asks the user to identify themselves. Once identified, the app receives an authentication token.</span></li>
  <li class="li2"><span class="s4"></span><span class="s3">App takes authentication token to the authorization server and exchanges it for either an access token with scope or an ID token without scope (and optionally a refresh token).</span></li>
  <li class="li2"><span class="s4"></span><span class="s3">App takes authorization token to resource server and presents it as proof that identity has been established and authorization has been received to perform actions on resources.</span></li>
  <li class="li2"><span class="s4"></span><span class="s3">The app presents the token as part of each request from then on until the token expires.</span></li>
  <li class="li2"><span class="s4"></span><span class="s3">When the token expires, the app goes to the authorization server and, assuming the user has not revoked consent, exchanges the refresh token for a new access token and goes back to the resource server and presents it to continue working on resources.</span></li>
</ul>
<h2 style="margin: 0.0px 0.0px 16.0px 0.0px; line-height: 22.0px; font: 18.0px Roboto; color: #000000; color: rgba(0, 0, 0, 0.87); -webkit-text-stroke: rgba(0, 0, 0, 0.87); background-color: #ffffff"><span class="s1"><b>AODocs API authentication flow</b></span></h2>
<p class="p3"><span class="s1">When the client app gets the user to authenticate, Google generates two tokens: an ID token (JWT) without any scope; and an access token with email address visibility scope (Â <a href="https://www.googleapis.com/auth/userinfo.email"><span class="s5">https://www.googleapis.com/auth/userinfo.email</span></a>Â ). After this step, the AODocs authentication flow is similar, but with some key differences.</span></p>
<p class="p3"><span class="s1">Each request to AODocs APIs must satisfy two requirements: identify the user, and certify that the provided token was generated by Google. Either of the tokens issued by Google is capable of providing this proof, so the client app can choose which token serves its purposes better.</span></p>
<p class="p2"><span class="s6">ðŸ’¡</span><span class="s3"> Tip: The ID token is sufficient to perform AODocs-only actions. Meanwhile, the access token has the same capability, but additionally allows AODocs to impersonate the user to get access to the Drive scopes required to call Drive APIs.</span></p>
<p class="p3"><span class="s1">The AODocs authentication flow:</span></p>
<ul class="ul1">
  <li class="li2"><span class="s4"></span><span class="s3">User asks app to access resource server.</span></li>
  <li class="li2"><span class="s4"></span><span class="s3">App asks resource server for access.</span></li>
  <li class="li2"><span class="s4"></span><span class="s3">If no token is included in the request, resource server redirects app to authorization server (Google) to obtain token.</span></li>
  <li class="li2"><span class="s4"></span><span class="s3">If identity has not been established yet, authorization server redirects app to identity provider (also Google).</span></li>
  <li class="li2"><span class="s4"></span><span class="s3">Identity provider (Google) asks the user to identify themselves. Once identified, the app receives an authentication token.</span></li>
  <li class="li2"><span class="s4"></span><span class="s3">App takes authentication token to the authorization server (Google) and exchanges it for either anÂ <b>access token</b>Â with userinfo.email scope; or anÂ <b>ID token</b>Â without scope (and optionally a refresh token).</span></li>
  <li class="li2"><span class="s4"></span><span class="s3">Depending on what the client app needs to do during each and every request, it chooses the appropriate token for that action and presents it to the resource server to prove that identity has been established, until the token expires.</span></li>
  <li class="li2"><span class="s4"></span><span class="s3">When the token expires, the app goes to the authorization server and, assuming the user has not revoked consent, exchanges the refresh token for a new access token and goes back to the resource server and presents it to continue working on resources.</span></li>
</ul>
<p class="p5"><span class="s7">__[Â </span><span class="s1">SIMPLE CHART</span><span class="s7">Â ]</span></p>
<p class="p2"><span class="s2">â­‘</span><span class="s3">Â <b>Note</b>: Normally you need access to the Google Drive API only in order to put content into AODocs. There is little need to access the Drive API after this point, so you only need email scope.</span></p>
<h2 style="margin: 0.0px 0.0px 16.0px 0.0px; line-height: 22.0px; font: 18.0px Roboto; color: #000000; color: rgba(0, 0, 0, 0.87); -webkit-text-stroke: rgba(0, 0, 0, 0.87); background-color: #ffffff"><span class="s1"><b>Get an access and ID token</b></span></h2>
<p class="p3"><span class="s1">There are many ways of obtaining an OAuth 2.0 token. Describing all the use cases is beyond the scope of this document. You can read more about Google's approach on the following Google documentation pages:</span></p>
<ul class="ul1">
  <li class="li6"><span class="s4"><a href="https://support.google.com/googleapi/answer/6158849?hl=en"><span class="s8">Setting up OAuth 2.0 - API Console Help</span></a></span></li>
  <li class="li6"><span class="s4"><a href="https://developers.google.com/identity/protocols/OAuth2"><span class="s8">Using OAuth 2.0 to Access Google APIs | Google Identity Platform</span></a></span></li>
  <li class="li6"><span class="s4"><a href="https://developers.google.com/identity/protocols/OAuth2UserAgent"><span class="s8">OAuth 2.0 for Client-side Web Applications | Google Identity Platform</span></a></span></li>
  <li class="li6"><span class="s4"><a href="https://developers.google.com/identity/protocols/OAuth2WebServer"><span class="s8">Using OAuth 2.0 for Web Server Applications | Google Identity Platform</span></a></span></li>
</ul>
<h2 style="margin: 0.0px 0.0px 16.0px 0.0px; line-height: 22.0px; font: 18.0px Roboto; color: #000000; color: rgba(0, 0, 0, 0.87); -webkit-text-stroke: rgba(0, 0, 0, 0.87); background-color: #ffffff"><span class="s1"><b>Use access or ID token</b></span></h2>
<p class="p3"><span class="s1">When you receive tokens from Google, they should look something along the lines of the following.</span></p>
<h3 style="margin: 0.0px 0.0px 16.0px 0.0px; line-height: 17.0px; font: 14.0px Roboto; color: #000000; color: rgba(0, 0, 0, 0.87); -webkit-text-stroke: rgba(0, 0, 0, 0.87); background-color: #ffffff"><span class="s1"><b>Sample tokens from Google</b></span></h3>
<p class="p8"><span class="s1">{</span></p>
<p class="p9"><span class="s9"><span class="Apple-converted-space">Â  Â  </span>"access_token": </span><span class="s1">"ya29.Il-3B5J8...Fhl3a-yRjpg"</span><span class="s9">,</span></p>
<p class="p9"><span class="s9"><span class="Apple-converted-space">Â  Â  </span>"id_token": </span><span class="s1">"eyJhbGc8i...AaNVQ"</span></p>
<p class="p9"><span class="s9"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">"expires_in"</span><span class="s9">: </span><span class="s1">3600</span><span class="s9">,</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>"token_type": </span><span class="s10">"Bearer"</span><span class="s1">,</span></p>
<p class="p9"><span class="s9"><span class="Apple-converted-space">Â  Â  </span>"scope": </span><span class="s1">"https://www.googleapis.com/auth/userinfo.email openid"</span><span class="s9">,</span></p>
<p class="p9"><span class="s9"><span class="Apple-converted-space">Â  Â  </span>"refresh_token": </span><span class="s1">"1//04c6onWq2AZDqCgYIARAAGAQSNwF-L9Ir2sI1rrhHr4IsCX_yNfu1YM9yc8AqB-u04JncAQwIxM1mU9Qv1NGvzLSiixS768nWovE"</span></p>
<p class="p8"><span class="s1">}</span></p>
<p class="p2"><span class="s2">â­‘</span><span class="s3">Â <b>Note</b>: Access tokens usually start with the stringÂ </span><span class="s11">ya29.</span><span class="s3">, and because they're opaque (not actual data but pointers to data elsewhere), they're usually shorter than ID tokens. The latter are longer because they contain actual data, encoded into three pieces: header, claims, and signature.</span></p>
<p class="p3"><span class="s1">Once you have obtained a token, you select which token is more appropriate for your use case:</span></p>
<ul class="ul1">
  <li class="li2"><span class="s4"></span><span class="s3">access token for AODocsÂ <i>and</i>Â Drive</span></li>
  <li class="li2"><span class="s4"></span><span class="s3">ID token for just AODocs</span></li>
</ul>
<p class="p3"><span class="s1">You can access AODocs APIs by including one of the tokens as anÂ </span><span class="s11">Authorization</span><span class="s1">Â HTTP headerÂ </span><span class="s11">Bearer</span><span class="s1">Â value:</span></p>
<p class="p5"><span class="s1">Authorization: Bearer &lt; access_token | id_token &gt;</span></p>
<h3 style="margin: 0.0px 0.0px 16.0px 0.0px; line-height: 17.0px; font: 14.0px Roboto; color: #000000; color: rgba(0, 0, 0, 0.87); -webkit-text-stroke: rgba(0, 0, 0, 0.87); background-color: #ffffff"><span class="s1"><b>Example request with token as header parameter</b></span></h3>
<p class="p8"><span class="s1">GET https://aodocs.altirnao.com/api/document/v1 HTTP/1.1</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p8"><span class="s1">Authorization: Bearer [YOUR_TOKEN] \</span></p>
<p class="p8"><span class="s1">Accept: application/json \</span></p>
<p class="p8"><span class="s1">Content-Type: application/json \</span></p>
<p class="p8"><span class="s1">{</span></p>
<p class="p9"><span class="s9"><span class="Apple-converted-space">Â  </span>"libraryId": </span><span class="s1">"Rngc1ug8K6WmL3IjZ8"</span></p>
<p class="p8"><span class="s1">}</span></p>
<h3 style="margin: 0.0px 0.0px 16.0px 0.0px; line-height: 17.0px; font: 14.0px Roboto; color: #000000; color: rgba(0, 0, 0, 0.87); -webkit-text-stroke: rgba(0, 0, 0, 0.87); background-color: #ffffff"><span class="s1"><b>Example Java request with a token</b></span></h3>
<p class="p9"><span class="s9"><span class="Apple-converted-space">Â  </span>executeGet(</span><span class="s1">"https://aodocs.altirnao.com/api/document/v1/RnTzVT28x5Sb48h3vSQ"</span><span class="s9">, myOAuthToken, otherParam1, requestBody)</span></p>
<h3 style="margin: 0.0px 0.0px 16.0px 0.0px; line-height: 17.0px; font: 14.0px Roboto; color: #000000; color: rgba(0, 0, 0, 0.87); -webkit-text-stroke: rgba(0, 0, 0, 0.87); background-color: #ffffff"><span class="s1"><b>Token expiration</b></span></h3>
<p class="p3"><span class="s1">Some tokens have a built-in expiration. If you requested offline access to token scopes, you canÂ <a href="https://developers.google.com/identity/protocols/OAuth2InstalledApp#offline"><span class="s5">refresh</span></a>Â tokens as necessary without having to prompt the user for permission.</span></p>
<h2 style="margin: 0.0px 0.0px 16.0px 0.0px; line-height: 22.0px; font: 18.0px Roboto; color: #000000; color: rgba(0, 0, 0, 0.87); -webkit-text-stroke: rgba(0, 0, 0, 0.87); background-color: #ffffff"><span class="s1"><b>__Whitelisting users using Google Groups?</b></span></h2>
<p class="p3"><span class="s1">[TBD]</span></p>
<h2 style="margin: 0.0px 0.0px 16.0px 0.0px; line-height: 22.0px; font: 18.0px Roboto; color: #000000; color: rgba(0, 0, 0, 0.87); -webkit-text-stroke: rgba(0, 0, 0, 0.87); background-color: #ffffff"><span class="s1"><b>___Authentication errors with access/ID tokens</b></span></h2>
<p class="p3"><span class="s1">Token errors occur only when the token is:</span></p>
<ul class="ul1">
  <li class="li2"><span class="s4"></span><span class="s3">missing?</span></li>
  <li class="li2"><span class="s4"></span><span class="s3">incorrect?</span></li>
  <li class="li2"><span class="s4"></span><span class="s3">expired?</span></li>
</ul>
<p class="p3"><span class="s1">To create,manage, and troubleshoot your tokens, seeâ€¦</span></p>
<h2 style="margin: 0.0px 0.0px 16.0px 0.0px; line-height: 22.0px; font: 18.0px Roboto; color: #000000; color: rgba(0, 0, 0, 0.87); -webkit-text-stroke: rgba(0, 0, 0, 0.87); background-color: #ffffff"><span class="s1"><b>Additional authentication and OAuth 2.0 resources</b></span></h2>
<h3 style="margin: 0.0px 0.0px 16.0px 0.0px; line-height: 17.0px; font: 14.0px Roboto; color: #000000; color: rgba(0, 0, 0, 0.87); -webkit-text-stroke: rgba(0, 0, 0, 0.87); background-color: #ffffff"><span class="s1"><b>___General readings</b></span></h3>
<p class="p3"><span class="s1">Read more aboutÂ <a href="https://developers.google.com/identity/protocols/OAuth2"><span class="s5">using OAuth 2.0 to access APIs</span></a>Â in Google's documentation.</span></p>
<p class="p3"><span class="s1">More aboutÂ <a href="https://developers.google.com/drive/api/v3/about-auth"><span class="s5">authenticating your users</span></a>Â in general from Google.</span></p>
<p class="p11"><span class="s1"><a href="https://support.google.com/cloud/answer/9110914">Google Cloud scope FAQs<span class="s5"></span></a></span></p>
<p class="p11"><span class="s12">More aboutÂ <a href="https://oauth.net/2/"><span class="s13">OAuth 2.0 in general</span></a>.</span></p>
<p class="p3"><span class="s1">____other</span></p>
</body>
</html>
